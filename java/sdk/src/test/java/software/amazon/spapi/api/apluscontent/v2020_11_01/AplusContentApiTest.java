/*
 * Selling Partner API for A+ Content Management
 * With the A+ Content API, you can build applications that help selling partners add rich marketing content to their Amazon product detail pages. A+ content helps selling partners share their brand and product story, which helps buyers make informed purchasing decisions. Selling partners assemble content by choosing from content modules and adding images and text.
 *
 * OpenAPI spec version: 2020-11-01
 * 
 *
 * NOTE: This class is auto generated by the swagger code generator program.
 * https://github.com/swagger-api/swagger-codegen.git
 * Do not edit the class manually.
 */

package software.amazon.spapi.api.apluscontent.v2020_11_01;

import software.amazon.spapi.ApiResponse;
import com.amazon.SellingPartnerAPIAA.LWAAuthorizationCredentials;
import software.amazon.spapi.models.apluscontent.v2020_11_01.ErrorList;
import software.amazon.spapi.models.apluscontent.v2020_11_01.GetContentDocumentResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.ListContentDocumentAsinRelationsResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.PostContentDocumentApprovalSubmissionResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.PostContentDocumentAsinRelationsRequest;
import software.amazon.spapi.models.apluscontent.v2020_11_01.PostContentDocumentAsinRelationsResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.PostContentDocumentRequest;
import software.amazon.spapi.models.apluscontent.v2020_11_01.PostContentDocumentResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.PostContentDocumentSuspendSubmissionResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.SearchContentDocumentsResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.SearchContentPublishRecordsResponse;
import software.amazon.spapi.models.apluscontent.v2020_11_01.ValidateContentDocumentAsinRelationsResponse;
import org.junit.jupiter.api.Test;

import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse.BodyHandlers;
import java.util.*;

import static org.junit.jupiter.api.Assertions.*;

public class AplusContentApiTest {

   private static String endpoint = "http://localhost:3000";
   private static String authEndpoint = "http://localhost:3000/auth/o2/token";
   private static LWAAuthorizationCredentials credentials = LWAAuthorizationCredentials.builder()
        .clientId("clientId")
        .clientSecret("clientSecret")
        .refreshToken("refreshToken")
        .endpoint(authEndpoint)
        .build();

   private final AplusContentApi api = new AplusContentApi.Builder()
        .lwaAuthorizationCredentials(credentials)
        .endpoint(endpoint)
        .build();

    @Test
    public void createContentDocumentTest() throws Exception {
        instructBackendMock("createContentDocument", "200");
        PostContentDocumentRequest body = new PostContentDocumentRequest();
        String marketplaceId = "";

        ApiResponse<PostContentDocumentResponse> response = api.createContentDocumentWithHttpInfo(body, marketplaceId);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void getContentDocumentTest() throws Exception {
        instructBackendMock("getContentDocument", "200");
        String contentReferenceKey = "";
        String marketplaceId = "";
        List<String> includedDataSet = new ArrayList<>();

        ApiResponse<GetContentDocumentResponse> response = api.getContentDocumentWithHttpInfo(contentReferenceKey, marketplaceId, includedDataSet);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void listContentDocumentAsinRelationsTest() throws Exception {
        instructBackendMock("listContentDocumentAsinRelations", "200");
        String contentReferenceKey = "";
        String marketplaceId = "";

        ApiResponse<ListContentDocumentAsinRelationsResponse> response = api.listContentDocumentAsinRelationsWithHttpInfo(contentReferenceKey, marketplaceId, null, null, null);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void postContentDocumentApprovalSubmissionTest() throws Exception {
        instructBackendMock("postContentDocumentApprovalSubmission", "200");
        String contentReferenceKey = "";
        String marketplaceId = "";

        ApiResponse<PostContentDocumentApprovalSubmissionResponse> response = api.postContentDocumentApprovalSubmissionWithHttpInfo(contentReferenceKey, marketplaceId);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void postContentDocumentAsinRelationsTest() throws Exception {
        instructBackendMock("postContentDocumentAsinRelations", "200");
        PostContentDocumentAsinRelationsRequest body = new PostContentDocumentAsinRelationsRequest();
        String contentReferenceKey = "";
        String marketplaceId = "";

        ApiResponse<PostContentDocumentAsinRelationsResponse> response = api.postContentDocumentAsinRelationsWithHttpInfo(body, contentReferenceKey, marketplaceId);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void postContentDocumentSuspendSubmissionTest() throws Exception {
        instructBackendMock("postContentDocumentSuspendSubmission", "200");
        String contentReferenceKey = "";
        String marketplaceId = "";

        ApiResponse<PostContentDocumentSuspendSubmissionResponse> response = api.postContentDocumentSuspendSubmissionWithHttpInfo(contentReferenceKey, marketplaceId);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void searchContentDocumentsTest() throws Exception {
        instructBackendMock("searchContentDocuments", "200");
        String marketplaceId = "";

        ApiResponse<SearchContentDocumentsResponse> response = api.searchContentDocumentsWithHttpInfo(marketplaceId, null);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void searchContentPublishRecordsTest() throws Exception {
        instructBackendMock("searchContentPublishRecords", "200");
        String marketplaceId = "";
        String asin = "";

        ApiResponse<SearchContentPublishRecordsResponse> response = api.searchContentPublishRecordsWithHttpInfo(marketplaceId, asin, null);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void updateContentDocumentTest() throws Exception {
        instructBackendMock("updateContentDocument", "200");
        PostContentDocumentRequest body = new PostContentDocumentRequest();
        String contentReferenceKey = "";
        String marketplaceId = "";

        ApiResponse<PostContentDocumentResponse> response = api.updateContentDocumentWithHttpInfo(body, contentReferenceKey, marketplaceId);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }

    @Test
    public void validateContentDocumentAsinRelationsTest() throws Exception {
        instructBackendMock("validateContentDocumentAsinRelations", "200");
        PostContentDocumentRequest body = new PostContentDocumentRequest();
        String marketplaceId = "";

        ApiResponse<ValidateContentDocumentAsinRelationsResponse> response = api.validateContentDocumentAsinRelationsWithHttpInfo(body, marketplaceId, null);

        assertEquals(200, response.getStatusCode());
        assertValidResponsePayload(200, response.getData());
    }


    private void instructBackendMock(String response, String code) throws Exception {
        HttpRequest request = HttpRequest.newBuilder()
              .uri(new URI(endpoint + "/response/" + response + "/code/" + code))
              .POST(HttpRequest.BodyPublishers.noBody())
              .build();

        HttpClient.newHttpClient().send(request, BodyHandlers.discarding());
    }

    private static void assertValidResponsePayload(int statusCode, Object body) {
        if(statusCode != 204) assertNotNull(body);
    }
}
